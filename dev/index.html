<!DOCTYPE html>
<html>
    <head>
        <title>Warframe Loadout</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta name="viewport" content="width=device-width">
        <link rel="stylesheet" type="text/css" href="css/WarframeLoadout.css">
        <script data-main="js/WarframeLoadout" src="js/libs/require.js"></script>
    </head>
    <body>
        <div class="links"><div class="cell link"><a href="http://www.warframe.com">Warframe.com</a></div><div class="cell link"><a href="http://www.reddit.com/r/warframe">reddit r/Warframe</a></div><div class="cell link"><a href="http://www.reddit.com/r/Warframe/comments/1sdx2e/dpsframe_is_now_updated_for_damage_20/">(new) discussion thread on reddit</a></div></div>
        <div class="notes">Updated for Damage 2.0! (Update 11.5.4) dpsframe 11.5.4 rev. 3 <a href="https://forums.warframe.com/index.php?/topic/118754-a-web-based-dps-tool/page-2#entry1782591">changelog</a><br></div>
        <div id="optionsContainer" class="box"></div>
        <div id="weaponContainer" class="weapon"></div>
        <script type="text/template" id="weaponTemplate">
            <%var color_class = ""%>
            <% if (categoryName === "Favorite") { color_class = "fav" }%>
            <div class="cell">
                <div class="weaponHeader">
                    <span class="name <%=color_class%>"><%= weapon.get("name") %></span><span class="dps"><%= result.dps.toFixed(0) %> DPS</span> 
                    <div class="divitis fav <%= (categoryName === "Favorite") ? "rem" : "add" %> noselect"><%= (categoryName === "Favorite") ? "&#9734; Remove" : "&#9733; Add" %> Favorite</div>
                    <%if(categoryName === "Linked"){%>
                    <div class="divitis share rem noselect">Remove Linked</div>
                    <%}%>
                    <div class="divitis share pop noselect"><span class="share arrow noselect">&#8620;</span> Share</div>
                    <div class="popupContainer">
                        <div class="popup sharepopup hidden">
                            <input type="text" class="shareText">
                            </input>
                        </div>
                    </div>
                </div>
                <div class="mastery">
                    <span class="expandeddps">Burst: <%= result.burst.toFixed(0)%> DPS, Ancient: <%= weapon.get('ancient').toFixed(0)%> DPS, Napalm: <%= weapon.get('napalm').toFixed(0)%> DPS, Tech: <%= weapon.get('tech').toFixed(0)%> DPS, MOA: <%= weapon.get('moa').toFixed(0)%> DPS</span>
                    
                    <br>
                    Mastery rank: <%= weapon.get('masteryRank')%>
                </div>
                <div class="cell">
                    <table class="damage">
                    <thead>
                        <tr>
                            <th>Shot Damage</th><th></th>
                        </tr>
                    </thead>
                    <tbody>
                    <%for(var key in result['damageBreakdown']){%>
                        <% if (result['damageBreakdown'][key].toFixed(0) != 0) {%>
                        <tr>
                            <td><%= key %></td><td class="right"><%= result['damageBreakdown'][key].toFixed(0)%></td>
                        </tr>
                        <%}%>
                    <%}%>
                        <tr>
                            <td>Total per shot</td><td class="right"><%= result['shot'].toFixed(0)%></td>
                        </tr>
                    </tbody>
                    </table>
                    <div class="popupContainer">
                        <div class="popup dps hidden">
                             <div class="cell">
                                <table class="damage">
                                <thead>
                                    <tr>
                                        <th>DPS</th><th></th>
                                    </tr>
                                </thead>
                                <tbody>
                                <%for(var key in result['dpsBreakdown']){%>
                                    <% if (result['damageBreakdown'][key].toFixed(0) != 0) {%>
                                    <tr>
                                        <td><%= key %></td><td class="right"><%= result['dpsBreakdown'][key].toFixed(0)%></td>
                                    </tr>
                                    <%}%>
                                <%}%>
                                    <tr>
                                        <td>Total DPS</td><td class="right"><%= result['dps'].toFixed(0)%></td>
                                    </tr>
                                </tbody>
                                </table>
                            </div>
                            <div class="cell">
                                <table class="damage">
                                <thead>
                                    <tr>
                                        <th>Burst</th><th></th>
                                    </tr>
                                </thead>
                                <tbody>
                                <%for(var key in result['dpsBreakdown']){%>
                                    <% if (result['damageBreakdown'][key].toFixed(0) != 0) {%>
                                    <tr>
                                        <td><%= key %></td><td class="right"><%= result['burstBreakdown'][key].toFixed(0)%></td>
                                    </tr>
                                    <%}%>
                                <%}%>
                                    <tr>
                                        <td>Total burst DPS</td><td class="right"><%= result['burst'].toFixed(0)%></td>
                                    </tr>
                                </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="cell">
                    <table class="stats">
                    <thead>
                        <tr>
                            <th>Stats</th><th></th>
                        </tr>
                    </thead>
                    <tbody>
                    <%for(var key in result['stats']){%>
                        <%var stat_name = key %>
                        <%var stat_value = result['stats'][key] %>
                        <%if(stat_name === "Crit Damage") {
                            stat_value = (stat_value *= 100).toFixed(0) + "%";
                          } else if((stat_name === "Crit Chance") || (stat_name === "Status Chance")){
                            stat_value = (stat_value *= 100).toFixed(2) + "%";
                          } else {
                            stat_value = stat_value.toFixed(2);
                          }%>
                        <tr>
                            <td><%= stat_name %></td><td class="right"><%= stat_value%></td>
                        </tr>
                    <%}%>
                    </tbody>
                    </table>
                    <div class="popupContainer">
                        <div class="popup stats hidden">
                        <table class="stats">
                            <thead>
                                <tr>
                                    <th>Base Stats</th><th></th>
                                </tr>
                            </thead>
                            <tbody>
                            <%for(var key in result['baseDamageStats']){%>
                                <%var stat_name = key %>
                                <%var stat_value = result['baseDamageStats'][key].toFixed(2) %>
                                <%if(stat_value > 0) {%>
                                    <tr>
                                        <td><%= stat_name %></td><td class="right"><%= stat_value%></td>
                                    </tr>
                                <%}%>
                                
                           <%}%>
                           <tr>
                               <td></td><td class="right"></td>
                           </tr>
                            <%for(var key in result['stats']){%>
                                <%var stat_name = key %>
                                <%var stat_value = weapon.get(key) %>
                                <%if(stat_name === "Crit Damage") {
                                    stat_value = (stat_value *= 100).toFixed(0) + "%";
                                  } else if(stat_name === "Crit Chance"){
                                    stat_value = (stat_value *= 100).toFixed(2) + "%";
                                  } else if(stat_name === "Status Chance"){
                                    stat_value = stat_value.toFixed(2) + "%";
                                  }else {
                                    stat_value = stat_value.toFixed(2);
                                  }%>
                                <tr>
                                    <td><%= stat_name %></td><td class="right"><%= stat_value%></td>
                                </tr>
                           <%}%>
                           </tbody>
                           </table>
                        </div>
                    </div>
                </div>
                <div class="cell">
                    <% var ancientAlts = weapon.get('ancientAltsDps');%>
                    <% var napalmAlts = weapon.get('napalmAltsDps');%>
                    <% var techAlts = weapon.get('techAltsDps');%>
                    <% var moaAlts = weapon.get('moaAltsDps');%>
                    <% var ancientMods = result['ancient'].get('damageMultipliers');%>
                    <% var napalmArmorMods = result['napalm'].get('armorMultipliers');%>
                    <% var napalmHealthMods = result['napalm'].get('damageMultipliers');%>
                    <% var techShieldMods = result['tech'].get('shieldMultipliers');%>
                    <% var techHealthMods = result['tech'].get('damageMultipliers');%>
                    <% var moaShieldMods = result['moa'].get('shieldMultipliers');%>
                    <% var moaHealthMods = result['moa'].get('damageMultipliers');%>
                    <table class="scaling">
                       <thead>
                            <tr>
                                <th>Type</th><th class="ancient right">Ancient</th>
                                <th class="napalm right">Napalm</th>
                                <th class="tech right">Tech</th>
                                <th class="moa right">MOA</th>
                            </tr>
                            </thead>
                         <tbody>
                            <%for(var key in ancientAlts){%>
                                <tr>
                                    <td><%= key %></td><td class="right"><%= ancientAlts[key]['DPS'].toFixed(0)%></td><td class="right"><%= napalmAlts[key]['DPS'].toFixed(0)%></td><td class="right"><%= techAlts[key]['DPS'].toFixed(0)%></td><td class="right"><%= moaAlts[key]['DPS'].toFixed(0)%></td>
                                </tr>
                            <%}%>
                        </tbody>
                    </table>
                    <div class="popupContainer">
                        <div class="popup enemies ancient hidden">
                            <table class="enemies">
                            <thead>
                            <tr>
                                <th>Ancient</th><th class="right">Fossilized</th>
                            </tr>
                            </thead>
                            <tbody>
                                <%for(var key in result['damageBreakdown']){%>
                                <tr>
                                    <td><%= key %></td>
                                    <% if(ancientMods[key]) {%>
                                        <td class="right"><span class="<%= (ancientMods[key] < 0) ? "red" : "green" %>"><%= ancientMods[key].toFixed(2)%></span></td>
                                    <%} else {%>
                                        <td class="right">-</td>
                                    <%}%>
                                </tr>
                            <%}%>
                           </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="popupContainer">
                        <div class="popup enemies napalm hidden">
                            <table class="enemies">
                            <thead>
                            <tr>
                                <th>Napalm</th><th class="right">Alloy</th><th class="right">Cloned</th>
                            </tr>
                            </thead>
                            <tbody>
                                <%for(var key in result['damageBreakdown']){%>
                                <tr>
                                    <td><%= key %></td>
                                    <% if(napalmArmorMods[key]) {%>
                                        <td class="right"><span class="<%= (napalmArmorMods[key] < 0) ? "red" : "green" %>"><%= napalmArmorMods[key].toFixed(2)%></span></td>
                                    <%} else {%>
                                        <td class="right">-</td>
                                    <%}%>
                                    <% if(napalmHealthMods[key]) {%>
                                        <td class="right"><span class="<%= (napalmHealthMods[key] < 0) ? "red" : "green" %>"><%= napalmHealthMods[key].toFixed(2)%></span></td>
                                    <%} else {%>
                                        <td class="right">-</td>
                                    <%}%>
                                </tr>
                            <%}%>
                           </tbody>
                           </table>
                           <span>Armor Note:<br>In 11.3.3 a 0.75 factor<br> means 100 armor drops<br>to 25 (armor * 1-0.75)<br> and it also gives a 75% <br>damage factor.</span>
                        </div>
                    </div>
                    <div class="popupContainer">
                        <div class="popup enemies tech hidden">
                            <table class="enemies">
                            <thead>
                            <tr>
                                <th>Tech</th><th class="right">Proto</th><th class="right">Flesh</th>
                            </tr>
                            </thead>
                            <tbody>
                                <%for(var key in result['damageBreakdown']){%>
                                <tr>
                                    <td><%= key %></td>
                                    <% if(techShieldMods[key]) {%>
                                        <td class="right"><span class="<%= (techShieldMods[key] < 0) ? "red" : "green" %>"><%= techShieldMods[key].toFixed(2)%></span></td>
                                    <%} else {%>
                                        <td class="right">-</td>
                                    <%}%>
                                    <% if(techHealthMods[key]) {%>
                                        <td class="right"><span class="<%= (techHealthMods[key] < 0) ? "red" : "green" %>"><%= techHealthMods[key].toFixed(2)%></span></td>
                                    <%} else {%>
                                        <td class="right">-</td>
                                    <%}%>
                                </tr>
                            <%}%>
                           </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="popupContainer">
                        <div class="popup enemies moa hidden">
                            <table class="enemies">
                            <thead>
                            <tr>
                                <th>Moa</th><th class="right">Shield</th><th class="right">Robotic</th>
                            </tr>
                            </thead>
                            <tbody>
                                <%for(var key in result['damageBreakdown']){%>
                                <tr>
                                    <td><%= key %></td>
                                    <% if(moaShieldMods[key]) {%>
                                        <td class="right"><span class="<%= (moaShieldMods[key] < 0) ? "red" : "green" %>"><%= moaShieldMods[key].toFixed(2)%></span></td>
                                    <%} else {%>
                                        <td class="right">-</td>
                                    <%}%>
                                    <% if(moaHealthMods[key]) {%>
                                        <td class="right"><span class="<%= (moaHealthMods[key] < 0) ? "red" : "green" %>"><%= moaHealthMods[key].toFixed(2)%></span></td>
                                    <%} else {%>
                                        <td class="right">-</td>
                                    <%}%>
                                </tr>
                            <%}%>
                           </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="cell">
                <div class="auras">
                    <div class="cell">
                        Auras
                    </div>
                </div>
                <div class="modHeader">
                    <div class="modCount">Active Mods: <%= weapon.get("activeModCount")%>,</div>
                    <div class="modPoints">Total Points: <%= weapon.get("activeModPoints")%></div>
                </div>
                <div class="cell modules">
                </div>
            </div>
        </script>
        <script type="text/template" id="moduleTemplate">
            <% var mod_fade = '' %>
            <% if(module.get('currentRank') === 0) { mod_fade = 'faded' } else if (module.get('currentRank') != module.get('maxRanks')){ mod_fade = 'partialfade' } %>
            <% var current_rank = module.get('currentRank') - 1 %>
            <% if(current_rank === -1){ current_rank = "-";} %>
            <% var sign = ""%>
            <% if(module.get('moduleDpsDifference') >= 0) { sign = "+"}%>
            <div class="inc rank noselect">+</div>
            <div class="mid rank noselect <%= mod_fade%>"><%= current_rank %> / <%= module.get('maxRanks') - 1 %></div>
            <div class="dec rank noselect">-</div>
            <div class="moduletext <%= mod_fade%>"><%= module.get('name')%> <span class="damageDiff">(<%= sign%><%= module.get('moduleDpsDifference').toFixed(0) %>)</span></div>
            <div class="popupContainer">
                <div class="popup hidden">
                    <%var percents = module.getPercents();%>
                    <%var types = module.get('types');%>
                    <% for(key in percents){%>
                        <% if(key !== "Puncture"){%>
                            <div><%= key %>: <%= percents[key]%>% (<%=types[key]%>% per point)</div>
                        <%} else {%>
                            <div><%= key %>: <%= percents[key] / 100%> meters (<%=types[key] / 100%> m per point)</div>
                        <%}%>
                    <%}%>
                    <div class="totalModDps"></div>
                </div>
            </div>
        </script>
        <script type="text/template" id="auraHeaderTemplate">
            <div class="cell auras" id="auraHeader">AURAS</div>
            <div class="cell auras" id="auras"></div>
            <div class="cell auras noselect recalc">Recalculate all</div>
        </script>
        <script type="text/template" id="auraTemplate">
            <%var percents = aura.getPercents();%>
            <% var mod_fade = '' %>
            <% if(aura.get('currentRank') === 0) { mod_fade = 'faded' } else if (aura.get('currentRank') != aura.get('maxRanks')){ mod_fade = 'partialfade' } %>
            <% var current_rank = aura.get('currentRank') - 1 %>
            <% var people = Math.floor((aura.get('currentRank') - 1) / 6) + 1 %>
            <% current_rank = (current_rank % 6) %>
            <% if(current_rank === -1){ current_rank = "-";} %>
            <% var sign = ""%>
            <% if(aura.get('moduleDpsDifference') >= 0) { sign = "+"}%>
            <div class="inc rank noselect">+</div>
            <div class="mid rank noselect <%= mod_fade%>"><%= current_rank %> / <%= (aura.get('maxRanks') - 1) % 6 %> (<%= people %>)</div>
            <div class="dec rank noselect">-</div>
            <div class="moduletext <%= mod_fade%>"><%= percents[Object.keys(percents)[0]] %>% <%= aura.get('name')%> <span class="damageDiff">(<%= sign%><%= aura.get('moduleDpsDifference').toFixed(0) %>)</span>
            <div class="popupContainer">
                <div class="popup aura hidden">
                    <%var types = aura.get('types');%>
                    <% for(key in percents){%>
                        <div><%= key %>: <%= percents[key]%>% (<%=types[key]%>% per point)</div>
                    <%}%>
                    <div class="totalAuraDps"></div>
                </div>
            </div>
        </script>
        <script type="text/template" id="optionsTemplate">
            <div class="option noselect <%= op.get('option')%> mark"><%= op.get('name')%></div>
        </script>
        <script type="text/template" id="weaponHeaderTemplate">
            <div class="box weaponTypeHeader <%= weaponType.toLowerCase() %>" id="<%= weaponType.toLowerCase()%>">
                <div class="weaponCategoryHeader">
                    <div class="cell" id="sortContainer"><%= weaponType.toUpperCase() %><% if(weaponType.toUpperCase() !== "LINKED"){%>S<%}%></div>
                </div>
            </div>
        </script>
        <script type="text/template" id="weaponCategoryTemplate">
            <div></div>
        </script>
        <script type="text/template" id="sortTemplate">
            <% var local_name = sortType.get('name').toLowerCase().replace(/ /g,'') %>
            <% var state =  "" %>
            <% if(sort_name === local_name){  
                    state = ""
               } else {
                    state = "faded" 
               } %>
            <div class="sortType <%= local_name %> <%= (sort_asc) ? "asc" : "desc" %> noselect <%= state %>"><%= sortType.get('name')%></div>
        </script>
        <script type="text/template" id="searchTemplate">
            <div class="filter"><input type="text" class="filter" placeholder="Filter name.."></input></div>
        </script>
    </body>
</html>